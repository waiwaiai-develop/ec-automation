<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}EC自動化{% endblock %} | ダッシュボード</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { font-family: "Hiragino Sans", "Noto Sans JP", sans-serif; }
        .navbar-brand { font-weight: bold; }
        .stat-card { border-left: 4px solid; }
        .stat-card.primary { border-left-color: #0d6efd; }
        .stat-card.success { border-left-color: #198754; }
        .stat-card.warning { border-left-color: #ffc107; }
        .stat-card.info { border-left-color: #0dcaf0; }
        .table th { white-space: nowrap; }
        .badge-in_stock { background-color: #198754; }
        .badge-out_of_stock { background-color: #dc3545; }
        .badge-discontinued { background-color: #6c757d; }
        .badge-active { background-color: #198754; }
        .badge-draft { background-color: #ffc107; color: #000; }
        .badge-paused { background-color: #6c757d; }
        .badge-pending { background-color: #ffc107; color: #000; }
        .badge-shipped { background-color: #0dcaf0; color: #000; }
        .badge-delivered { background-color: #198754; }
        .thumb-img { max-width: 60px; max-height: 60px; object-fit: cover; border-radius: 4px; }
        .detail-img { max-width: 200px; max-height: 200px; object-fit: contain; border-radius: 8px; border: 1px solid #dee2e6; }
        .category-bar { height: 24px; border-radius: 4px; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
        <div class="container">
            <a class="navbar-brand" href="/">EC自動化</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMain">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navMain">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link {% if request.path == '/' %}active{% endif %}" href="/">ダッシュボード</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if '/products' in request.path %}active{% endif %}" href="/products">商品</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if '/listings' in request.path %}active{% endif %}" href="/listings">出品</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if '/orders' in request.path %}active{% endif %}" href="/orders">注文</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container">
        {% block content %}{% endblock %}
    </div>

    <footer class="container mt-5 mb-3 text-center text-muted">
        <small>EC自動化ダッシュボード</small>
    </footer>

    <!-- トースト通知コンテナ -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3" id="toastContainer"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    // トースト表示関数
    function showToast(message, type) {
        type = type || 'success';
        var bgClass = {success:'bg-success',danger:'bg-danger',warning:'bg-warning text-dark',info:'bg-info text-dark'}[type] || 'bg-secondary';
        var html = '<div class="toast align-items-center text-white ' + bgClass + ' border-0" role="alert">'
            + '<div class="d-flex"><div class="toast-body">' + message + '</div>'
            + '<button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>'
            + '</div></div>';
        var container = document.getElementById('toastContainer');
        container.insertAdjacentHTML('beforeend', html);
        var el = container.lastElementChild;
        var toast = new bootstrap.Toast(el, {delay: 4000});
        toast.show();
        el.addEventListener('hidden.bs.toast', function() { el.remove(); });
    }

    // API呼び出しラッパー
    function apiRequest(url, data, onSuccess, onError) {
        fetch(url, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(data || {})
        })
        .then(function(resp) { return resp.json(); })
        .then(function(result) {
            if (result.error) {
                showToast(result.error, 'danger');
                if (onError) onError(result);
            } else {
                if (onSuccess) onSuccess(result);
            }
        })
        .catch(function(err) {
            showToast('通信エラー: ' + err.message, 'danger');
            if (onError) onError({error: err.message});
        });
    }
    </script>
</body>
</html>
